pipeline {
    agent any
   
    stages {

      stage('clean and build')
            {
                steps
                 { 
                    sh 'mvn clean package'
                 }
            }
        stage("nexus") {
            steps {
            environment {
                NEXUS_CRED = credentials('nexus-credentials')
            }
           curl -v -F r=devopstraining -F hasPom=true -F e=war -F file=@pom.xml -F file=@/var/lib/jenkins/workspace/DeployPipeline/target/auth-1.3.5.RELEASE.war -u $NEXUS_CRED http://ec2-18-224-155-110.us-east-2.compute.amazonaws.com:8081/nexus
                
            } 
        }
        
        stage('deploy'){
        steps{  
         
sshagent(['tomcat-dev']) {
            sh 'scp -o StrictHostKeyChecking=no target/*.war ec2-user@172.31.36.233:~/apache-tomcat-9.0.26/webapps/'
            }
        }
        }
        }
        }

